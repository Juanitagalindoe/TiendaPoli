<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${titulo}">Formulario de Factura</title>
    <!-- Modular CSS System -->
    <link rel="stylesheet" href="/css/base.css">
    <link rel="stylesheet" href="/css/buttons.css">
    <link rel="stylesheet" href="/css/tables.css">
    <link rel="stylesheet" href="/css/forms.css">
    <link rel="stylesheet" href="/css/alerts.css">
    <link rel="stylesheet" href="/css/layout.css">
    <link rel="icon" type="image/png" th:href="@{/IMG/Logo.png}">
</head>

<body>
    <div class="main-content">
        <!-- Header Section -->
        <header class="page-header">
            <h1 th:text="${titulo}">Formulario de Factura</h1>
        </header>

        <!-- Form Section -->
        <section class="form-section">
            <div class="form-container">
                <form th:action="@{/encabezado/guardar}" method="post" th:object="${encabezado}" class="client-form">
                    <!-- Campo oculto para indicar si es modificaci√≥n -->
                    <input type="hidden" name="esModificacion" th:value="${esModificacion}">
                    
                    <!-- Campo oculto para el ID en caso de modificaci√≥n -->
                    <input type="hidden" th:field="*{nroVenta}" th:if="${esModificacion}">

                    <!-- Selecci√≥n de Cliente -->
                    <div class="form-group">
                        <label for="cliente">Cliente *</label>
                        <select th:field="*{cliente.id}" id="cliente" class="form-control" required>
                            <option value="">Seleccione un cliente</option>
                            <option th:each="cliente : ${clientes}" 
                                    th:value="${cliente.id}" 
                                    th:text="${cliente.nombre + ' ' + cliente.apellido + ' (' + cliente.id + ')'}">
                            </option>
                        </select>
                        <div th:if="${errorCliente}" class="error-message" th:text="${errorCliente}"></div>
                    </div>

                    <!-- Fecha -->
                    <div class="form-group">
                        <label for="fechaStr">Fecha *</label>
                        <input type="date" name="fechaStr" id="fechaStr" class="form-control" required
                               th:value="${encabezado.fecha != null ? #dates.format(encabezado.fecha, 'yyyy-MM-dd') : ''}">
                        <div th:if="${errorFecha}" class="error-message" th:text="${errorFecha}"></div>
                    </div>

                    <!-- Hora -->
                    <div class="form-group">
                        <label for="horaStr">Hora *</label>
                        <input type="time" name="horaStr" id="horaStr" class="form-control" required
                               th:value="${encabezado.hora != null ? #dates.format(encabezado.hora, 'HH:mm') : ''}">
                        <div th:if="${errorHora}" class="error-message" th:text="${errorHora}"></div>
                    </div>

                    <!-- Subtotal -->
                    <div class="form-group">
                        <label for="subtotal">Subtotal *</label>
                        <input type="number" th:field="*{subtotal}" id="subtotal" class="form-control" 
                               step="0.01" min="0" placeholder="0.00" required>
                        <div th:if="${errorSubtotal}" class="error-message" th:text="${errorSubtotal}"></div>
                    </div>

                    <!-- Descuento -->
                    <div class="form-group">
                        <label for="dcto">Descuento</label>
                        <input type="number" th:field="*{dcto}" id="dcto" class="form-control" 
                               step="0.01" min="0" placeholder="0.00">
                        <div th:if="${errorDescuento}" class="error-message" th:text="${errorDescuento}"></div>
                    </div>

                    <!-- Total -->
                    <div class="form-group">
                        <label for="total">Total *</label>
                        <input type="number" th:field="*{total}" id="total" class="form-control" 
                               step="0.01" min="0" placeholder="0.00" required>
                        <div th:if="${errorTotal}" class="error-message" th:text="${errorTotal}"></div>
                    </div>

                    <!-- Error general -->
                    <div th:if="${errorGeneral}" class="error-message-general" th:text="${errorGeneral}"></div>

                    <!-- Botones de acci√≥n -->
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">
                            <span th:if="${esModificacion}">‚úÖ Actualizar</span>
                            <span th:unless="${esModificacion}">üíæ Guardar</span>
                        </button>
                        <a href="/encabezado" class="btn-link">
                            <button type="button" class="btn btn-secondary">‚ùé Cancelar</button>
                        </a>
                    </div>
                </form>
            </div>
        </section>
    </div>

    <!-- Footer Section -->
    <div th:replace="fragments/footer :: footer"></div>

    <!-- JavaScript modular -->
    <script src="/js/fencabezado.js"></script>
</body>

</html>